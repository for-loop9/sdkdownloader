name: Build Vulkan Loader

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Prepare Vulkan SDK
        uses: humbletim/setup-vulkan-sdk@v1.2.1
        with:
         vulkan-query-version: latest
         vulkan-components: Vulkan-Loader
         vulkan-use-cache: true

      - name: Install MinGW
        uses: msys2/setup-msys2@v2
        with:
          install: mingw-w64-x86_64-binutils

      - name: Generate MinGW import library
        shell: msys2 {0}
        run: |
          mkdir output
          gendef /c/Windows/System32/vulkan-1.dll
          dlltool -d vulkan-1.def -l output/libvulkan-1.a

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: libvulkan-1-a
          path: output
